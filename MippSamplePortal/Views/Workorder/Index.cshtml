@using Syncfusion.EJ2;
@using Syncfusion.EJ2.Navigations;
@using Syncfusion.EJ2.Grids;
@model IEnumerable<MippSamplePortal.ViewModel.WorkorderMasterModel>

@{
    ViewData["Title"] = "Index";
    var email = ViewBag.Email;
}
<html>
<body>
    <h1>Workorders</h1>

    <p>
        <a asp-action="Create" asp-route-email="@email">Create New</a>
    </p>

    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">

        <div class="btn-group mr-2" role="group" aria-label="First group">
            <button id="create" class="btn btn-default">Create New</button>

            <button id="edit" class="btn btn-default" disabled="true">Update</button>
            @*        <button id="details" class="btn btn-default" disabled="true">Create Bill</button>
            <button id="settings" class="btn btn-default">Settings</button>
            <button id="assigned" class="btn btn-default">Assigned</button>
            <button id="completed" class="btn btn-default">Completed</button>*@
        </div>

    </div>


    <div id="Grid"></div>
</body>

@section Scripts {

    <script src="~/dist/js/notify.js"></script>
    <script src="~/dist/js/notify.min.js"></script>

    <script>

        function showNotification(type, message) {
            $.notify(message, type);
        }

        function rowSelected() {
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords();
            //var selectedRecords = grid.getSelectedRecords();
            //var selectedRecordsCount = selectedRecords.length;
            console.log(document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords());
            console.log("selectedRecord:", grid);


            if (grid != null) {

                document.getElementById("edit").disabled = false;
            }
            else {
                document.getElementById("edit").disabled = true;
            }

        }


        document.getElementById('edit').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;

            var url = document.location.origin + "/Workorder/Edit/" + id;
            window.location.replace(url);

        };

        //document.getElementById('settings').onclick = function () {


        //    var vendorID = @ViewBag.VendorId

        //    var url = document.location.origin + "/Settings/Index?vendorId=" + vendorID;
        //    window.location.replace(url);

        //};

        //document.getElementById('assigned').onclick = function () {


        //    var vendorID = @ViewBag.VendorId

        //            var url = document.location.origin + "/Workorders/AssignedWorkorders?vendorId=" + vendorID;
        //    window.location.replace(url);

        //};
        //document.getElementById('completed').onclick = function () {


        //    var vendorID = @ViewBag.VendorId

        //    var url = document.location.origin + "/Workorders/CompletedWorkorders?vendorId=" + vendorID;
        //    window.location.replace(url);

        //};

        document.getElementById('create').onclick = function () {
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].currentViewData[0];
           

            var id = grid.VendorId;
            var url = document.location.origin + "/Workorders/Create/" + id;
            window.location.replace(url);


        };


                //document.getElementById('details').onclick = function () {

                //    var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
                //    var selectedRecords = grid.getSelectedRecords();

                //    if (selectedRecords[0].Status == "Approved") {
                //        var vendorID = selectedRecords[0].VendorId;
                //        var id = selectedRecords[0].Id;
                //        var url = document.location.origin + "/Bills/Index?vendorID=" + vendorID + "&woID=" + id;

                //        window.location.replace(url);
                //    }
                //    else {
                //        showNotification('warning', 'Workorder is not approved for billing!');
                //    }
                //};
    </script>

    <ejs-grid id="Grid" allowPaging="true" allowSorting="true"
          allowPdfExport="true" allowExcelExport="true" allowselection=" true" rowSelected="rowSelected" datasource="@ViewBag.GridData">
        <e-grid-pagesettings pageSize="5"></e-grid-pagesettings>
        @*<e-grid-editSettings allowAdding="true" allowDeleting="true" allowEditing="true"></e-grid-editSettings>
    <e-grid-filtersettings type="Menu"></e-grid-filtersettings>
    <e-grid-loadingIndicator indicatorType="Shimmer"></e-grid-loadingIndicator>
    <e-grid-selectionsettings persistSelection="true" type="Multiple" checkboxOnly="true"></e-grid-selectionsettings>*@
        <e-grid-columns>
            <e-grid-column type="checkbox" width="50" />
            <e-grid-column field="ServiceRequestNumber" header - text="Request Number" width="75" text-align="right"> </e-grid-column>
            <e-grid-column field="PropertyAddress" header-text="Property Address" width="80"> </e-grid-column>
            <e-grid-column field="Vendor" header-text="Vendor" width="80"> </e-grid-column>
            <e-grid-column field="Status" header-text="Status" text-align="right" width="75"> </e-grid-column>
            <e-grid-column field="ExpectedEndDate" header-text="End Date" text-align="right" width="75"> </e-grid-column>
        </e-grid-columns>
    </ejs-grid>
}
</html>
