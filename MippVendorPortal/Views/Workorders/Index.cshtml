@using Syncfusion.EJ2;
@using Syncfusion.EJ2.Navigations;
@using Syncfusion.EJ2.Grids;


@model IEnumerable<MippVendorPortal.ViewModel.WorkorderMasterModel>

@{
    ViewData["Title"] = "Index";
    // var tabHeaderOne = new TabHeader { Text = "Lokalizace" };
    //var tabHeaderTwo = new TabHeader { Text = "Cenik" };
    Layout = "~/Views/Shared/_LoggedInLayout.cshtml";
    var vendorId = ViewBag.VendorId;

}

@*<link href="~/p" rel="stylesheet" />
*@

<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">

    <div class="btn-group mr-2" role="group" aria-label="First group">
        @*        <button id="create" class="btn btn-default">Create New</button>
        *@
        
        
        <button id="edit" class="btn btn-default" disabled="true" hidden="true">Edit</button>
        <button id="details" class="btn btn-default" disabled="true">Create Bill</button>
        <button id="settings" class="btn btn-default">Settings</button>
        <div id="AcceptButtons" class="mx-2" hidden="true">
        <button id="accept" class="btn btn-primary" >Accept</button>
        <button id="decline" class="btn btn-danger">Decline</button>
        
        </div>

        
    </div>

</div>


<div id="Grid"></div>






@section Scripts {

    <script src="~/dist/js/notify.js"></script>
    <script src="~/dist/js/notify.min.js"></script>
   @* <script>
        if (@ViewBag.msg != null) {
            $(document).ready(function () {
                showNotification('success', @ViewBag.msg);
            });
        }
        function showNotification(type, message) {
            $.notify(message, type);
        }
    </script>*@
    <script src="~/dist/js/notify.js"></script>
    <script src="~/dist/js/notify.min.js"></script>
@*    <script src="https://ej2.syncfusion.com/javascript/demos/samples/grid/columntemplate/datasource.js" type="text/javascript"></script>
*@
    <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>

    <script>

        function showNotification(type, message) {
            $.notify(message, type);
        }

        function rowSelected() {
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords();
            //var selectedRecords = grid.getSelectedRecords();
            //var selectedRecordsCount = selectedRecords.length;
            console.log(document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords());
            console.log("selectedRecord:", grid);


            if (grid != null) {

                document.getElementById("edit").disabled = false;
                if(grid[0].Status=='Approved')
                document.getElementById("details").disabled = false;
            }
            else {
                document.getElementById("edit").disabled = true;
                document.getElementById("details").disabled = true;
            }
            if(grid[0].Status=='Assigned')
            {
                document.getElementById("AcceptButtons").hidden = false;
            }
            else
            {
                document.getElementById("AcceptButtons").hidden = true;
            }
             if(grid[0].Status=='Assigned' || grid[0].Status=='In Progress')
            {
                document.getElementById("edit").hidden = false;
            }
            else
            {
                document.getElementById("edit").hidden = true;
            }
        }
        function rowDeselected() {
            

            
                document.getElementById("edit").disabled = true;
                document.getElementById("edit").hidden = true;
                document.getElementById("details").disabled = true;
           
                document.getElementById("AcceptButtons").hidden = true;
            
        }


        document.getElementById('edit').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;
            if (selectedRecords[0].Status == "In Progress" || selectedRecords[0].Status == "Submit for Approval") 
            {
                var url = document.location.origin + "/Workorders/Edit/" + id;
                window.location.replace(url);
            }
            

        };

        

        document.getElementById('settings').onclick = function () {


            var vendorID = @ViewBag.VendorId

            var url = document.location.origin + "/Settings/Index?vendorId=" + vendorID;
            window.location.replace(url);

        };

        //document.getElementById('assigned').onclick = function () {


        //    var vendorID = @ViewBag.VendorId

        //            var url = document.location.origin + "/Workorders/AssignedWorkorders?vendorId=" + vendorID;
        //    window.location.replace(url);

        //};
        //document.getElementById('completed').onclick = function () {


        //    var vendorID = @ViewBag.VendorId

        //                    var url = document.location.origin + "/Workorders/CompletedWorkorders?vendorId=" + vendorID;
        //    window.location.replace(url);

        //};

        // document.getElementById('create').onclick = function () {
        //    var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].currentViewData[0];

        //    var id = grid.VendorId;
        //    var url = document.location.origin + "/Workorders/Create/" + id;
        //        window.location.replace(url);


        //};


        document.getElementById('details').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            var selectedRecords = grid.getSelectedRecords();

            if (selectedRecords[0].Status == "Approved") {
                var vendorID = selectedRecords[0].VendorId;
                var id = selectedRecords[0].Id;
                var url = document.location.origin + "/Bills/Index?vendorID=" + vendorID + "&woID=" + id;

                window.location.replace(url);
            }
            else {
                showNotification('warning', 'Workorder is not approved for billing!');
            }
        };
    </script>


    <ejs-grid id="Grid" allowPaging="true" allowSorting="true" toolbar="@(new List<string>() { "Search"})" rowSelection='single' rowSelected="rowSelected" rowDeselected="rowDeselected" allowFiltering="true" allowGrouping="true" datasource="@ViewBag.GridData">
        <e-grid-filterSettings type="Menu"></e-grid-filterSettings>
        <e-grid-pagesettings pageSize="5"></e-grid-pagesettings>

        <e-grid-columns>
            <e-grid-column type="checkbox" width="50" />
            <e-grid-column field="ServiceRequestNumber" header - text="Service Request Number" width="75" text-align="right"> </e-grid-column>
            <e-grid-column field="TenantName" header - text="Tenant Name" width="80"></e-grid-column>
            <e-grid-column field="TenantName" header - text="Tenant Name" width="80"></e-grid-column>
            <e-grid-column field="PropertyManager" header-text="PropertyManager" width="80"> </e-grid-column>
            <e-grid-column field="Status" header-text="Status" text-align="right" width="75"> </e-grid-column>
            <e-grid-column field="ExpectedEndDate" header-text="ExpectedEndDate" text-align="right" width="75"> </e-grid-column>
        </e-grid-columns>
    </ejs-grid>

    <script>
        window.onload = function(e){ 

                document.querySelector('#button_view').onclick = function () {

                console.log("Inside view button");
                var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
                console.log(grid);
                var selectedRecords = grid.getSelectedRecords();
                var id = selectedRecords[0].Id;

                var url = document.location.origin + "/Workorders/Edit/" + id;
                window.location.replace(url);

               

            };
        }

        

        document.getElementById('accept').onclick = function () {
            console.log("Inside view button");
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;

            var url = document.location.origin + "/Workorders/Accept/" + id;
            window.location.replace(url);

        };

        document.getElementById('decline').onclick = function () {
            console.log("Inside view button");
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;

            var url = document.location.origin + "/Workorders/Decline/" + id;
            window.location.replace(url);

        };
      </script>

@*    <script>
        ej.base.enableRipple(true)
        var grid = new ej.grids.Grid({
            dataSource: @ViewBag.GridData,
            columns: [

                { field: 'ServiceRequestNumber', headerText: 'ServiceRequestNumber', textAlign: 'Right', width: 125 },
                { field: 'Client', headerText: 'Client', width: 120 },
                { field: 'PropertyAddress', headerText: 'PropertyAddress', width: 170 },
                { field: 'Status', headerText: 'Status', width: 120, textAlign: 'Right' },
                { field: 'ExpectedEndDate', headerText: 'ExpectedEndDate', width: 120, textAlign: 'Right' },
                {
                    headerText: 'Actions', textAlign: 'Center',
                    template: '#template', width: 150
                },
            ],
            width: 'auto',
            height: 359
        });

        grid.appendTo('#Grid')
    </script>*@


}









