@using Syncfusion.EJ2;
@using Syncfusion.EJ2.Navigations;
@using Syncfusion.EJ2.Grids;


@model IEnumerable<MippVendorPortal.ViewModel.WorkorderMasterModel>

@{
    ViewData["Title"] = "Index";
    // var tabHeaderOne = new TabHeader { Text = "Lokalizace" };
    //var tabHeaderTwo = new TabHeader { Text = "Cenik" };
    Layout = "~/Views/Shared/_Layout.cshtml";
    var vendorId = ViewBag.VendorId;

}

@*<link href="~/p" rel="stylesheet" />
*@
<html>
    <body>
<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">

    <div class="btn-group mr-2" role="group" aria-label="First group">
        @*        <button id="create" class="btn btn-default">Create New</button>
        *@
        <button id="edit" class="btn btn-default" disabled="true">Edit</button>
        <button id="details" class="btn btn-default" disabled="true">Create Bill</button>
        <button id="settings" class="btn btn-default">Settings</button>
        <button id="assigned" class="btn btn-default">Assigned</button>
        <button id="completed" class="btn btn-default">Completed</button>
    </div>

</div>


<div id="Grid"></div>



</body>


@section Scripts {

    <script src="~/dist/js/notify.js"></script>
    <script src="~/dist/js/notify.min.js"></script>
   @* <script>
        if (@ViewBag.msg != null) {
            $(document).ready(function () {
                showNotification('success', @ViewBag.msg);
            });
        }
        function showNotification(type, message) {
            $.notify(message, type);
        }
    </script>*@
    <script src="~/dist/js/notify.js"></script>
    <script src="~/dist/js/notify.min.js"></script>
@*    <script src="https://ej2.syncfusion.com/javascript/demos/samples/grid/columntemplate/datasource.js" type="text/javascript"></script>
*@
    <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>

    <script>

        function showNotification(type, message) {
            $.notify(message, type);
        }

        function rowSelected() {
            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords();
            //var selectedRecords = grid.getSelectedRecords();
            //var selectedRecordsCount = selectedRecords.length;
            console.log(document.getElementsByClassName('e-grid')[0].ej2_instances[0].getSelectedRecords());
            console.log("selectedRecord:", grid);


            if (grid != null) {

                document.getElementById("edit").disabled = false;
                document.getElementById("details").disabled = false;
            }
            else {
                document.getElementById("edit").disabled = true;
                document.getElementById("details").disabled = true;
            }

        }


        document.getElementById('edit').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;

            var url = document.location.origin + "/Workorders/Edit/" + id;
            window.location.replace(url);

        };

        document.getElementById('view').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            console.log(grid);
            var selectedRecords = grid.getSelectedRecords();
            var id = selectedRecords[0].Id;

            var url = document.location.origin + "/Workorders/Edit/" + id;
            window.location.replace(url);

        };

        document.getElementById('settings').onclick = function () {


            var vendorID = @ViewBag.VendorId

            var url = document.location.origin + "/Settings/Index?vendorId=" + vendorID;
            window.location.replace(url);

        };

        document.getElementById('assigned').onclick = function () {


            var vendorID = @ViewBag.VendorId

                    var url = document.location.origin + "/Workorders/AssignedWorkorders?vendorId=" + vendorID;
            window.location.replace(url);

        };
        document.getElementById('completed').onclick = function () {


            var vendorID = @ViewBag.VendorId

                            var url = document.location.origin + "/Workorders/CompletedWorkorders?vendorId=" + vendorID;
            window.location.replace(url);

        };

        // document.getElementById('create').onclick = function () {
        //    var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0].currentViewData[0];

        //    var id = grid.VendorId;
        //    var url = document.location.origin + "/Workorders/Create/" + id;
        //        window.location.replace(url);


        //};


        document.getElementById('details').onclick = function () {

            var grid = document.getElementsByClassName('e-grid')[0].ej2_instances[0];
            var selectedRecords = grid.getSelectedRecords();

            if (selectedRecords[0].Status == "Approved") {
                var vendorID = selectedRecords[0].VendorId;
                var id = selectedRecords[0].Id;
                var url = document.location.origin + "/Bills/Index?vendorID=" + vendorID + "&woID=" + id;

                window.location.replace(url);
            }
            else {
                showNotification('warning', 'Workorder is not approved for billing!');
            }
        };
    </script>

    <script id="template" type="text/x-template">
        <div id="templateElement" style = "display: flex;">
               @*<button title="Accept" class="btn btn-success"><i class="fa-sharp fa-solid fa-check"></i></button>
               <button title="Decline" class="btn btn-danger"><i class="fa-sharp fa-solid fa-circle-xmark"></i></button>
*@               
                <button title="View" id="view" class="btn btn-light"><i class="fa-sharp fa-solid fa-eye"></i></button>
           </div>
          
    </script>



    <script id="template" type="text/x-template">
        ${if(Status == "Assigned" || Status == "Re-work requested")}
            <div id="templateElement" style = "display: flex;">
                <button title="Accept" class="btn btn-success"><i class="fa-sharp fa-solid fa-check"></i></button>
                <button title="Decline" class="btn btn-danger"><i class="fa-sharp fa-solid fa-circle-xmark"></i></button>
                <button title="View" class="btn btn-light"><i class="fa-sharp fa-solid fa-eye"></i></button>
            </div>

        ${else if(Status == "In Progress")}
            <div id="templateElement" style = "display: flex;">
                <button title="Edit" class="btn btn-light"><i class="fa-sharp fa-solid fa-pen-to-square"></i></button>
                <button title="View" class="btn btn-light"><i class="fa-sharp fa-solid fa-eye"></i></button>
            </div>
        ${else}
            <div id="templateElement" style = "display: flex;">
                <button title="View" class="btn btn-light"><i class="fa-sharp fa-solid fa-eye"></i></button>
            </div>
    </script>

    <script>
        //function rowBound(args) {
        //        console.log(args.data['Status']);
        //        //console.log("175", document.querySelector('#image'));
        //        console.log("176", document.querySelector('#template'));
        //        var templateDiv = document.createElement('div');
        //        templateDiv.style = "display: flex;flex-direction: row;justify-content: space-around;";
        //        templateDiv.id = "temp";
        //        if (document.querySelector('#template').children.length >0)
        //            document.querySelector('#template').removeChild(document.querySelector('#template').children[0]);
                

        //        if (args.data['Status'] == "In Progress") {
        //            var ViewButton = document.createElement('button');
        //            ViewButton.title = "View";
        //            ViewButton.className = "btn btn-light";
        //            var viewIcon = document.createElement('i');
        //            viewIcon.className = "fa-sharp fa-solid fa-eye";
        //        ViewButton.appendChild(viewIcon);
        //        templateDiv.appendChild(ViewButton);
        //            var editButton = document.createElement('button');
        //            editButton.title = "Edit";
        //            editButton.className = "btn btn-light";
        //            var editIcon = document.createElement('i');
        //            editIcon.className = "fa-sharp fa-solid fa-pen-to-square";
        //        editButton.appendChild(editIcon);
        //        templateDiv.appendChild(editButton);
        //        document.querySelector('#template').appendChild(templateDiv);
        //         }
        //         else{
        //        document.querySelector('#template').appendChild(templateDiv);
        //         }
            
            
        //}
    </script>


    <ejs-grid id="Grid" allowPaging="true" allowSorting="true"
          toolbar="@(new List<string>() { "Search"})" allow-selection="true" rowSelected="rowSelected" datasource="@ViewBag.GridData">
        <e-grid-pagesettings pageSize="5"></e-grid-pagesettings>

        <e-grid-columns>
            <e-grid-column type="checkbox" width="50" />
            <e-grid-column field="ServiceRequestNumber" headerText="Request Number" width="75" text-align="right"> </e-grid-column>
            <e-grid-column field="Client" headerText="Client" width="80"> </e-grid-column>
            <e-grid-column field="PropertyAddress" headerText="Property Address" width="80"> </e-grid-column>
            <e-grid-column field="Status" headerText="Status" text-align="right" width="75"> </e-grid-column>
            <e-grid-column field="ExpectedEndDate" headerText="End Date" text-align="right" width="75"> </e-grid-column>
            <e-grid-column headerText="Actions" template="#template" textAlign="Center" width="150" ></e-grid-column>                
        </e-grid-columns>
    </ejs-grid>



    <script>
        ej.base.enableRipple(true)
        var grid = new ej.grids.Grid({
            dataSource: @ViewBag.GridData,
            columns: [

                { field: 'ServiceRequestNumber', headerText: 'ServiceRequestNumber', textAlign: 'Right', width: 125 },
                { field: 'Client', headerText: 'Client', width: 120 },
                { field: 'PropertyAddress', headerText: 'PropertyAddress', width: 170 },
                { field: 'Status', headerText: 'Status', width: 120, textAlign: 'Right' },
                { field: 'ExpectedEndDate', headerText: 'ExpectedEndDate', width: 120, textAlign: 'Right' },
                {
                    headerText: 'Actions', textAlign: 'Center',
                    template: '#template', width: 150
                },
            ],
            width: 'auto',
            height: 359
        });

        grid.appendTo('#Grid')
    </script>


}


</html>






